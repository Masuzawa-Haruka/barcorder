# BarCorder プロジェクト - Copilotレビュー指示

## 重要: レビュー言語（最優先事項）

**このリポジトリのコードレビューは、必ず日本語で実施してください。英語でのレビューは一切使用しないでください。**

- すべてのレビューコメント、説明、提案は日本語で記述すること
- エラーメッセージや技術用語も可能な限り日本語で説明すること
- コード例やコメントも日本語で記述すること
- レビューは簡潔・断定的に記述し、**すべてのレビューコメントの冒頭に重要度【必須修正】【要改善】【任意】のいずれかを必ず明示すること**。

---

## 高レベルサマリー（レビュー冒頭テンプレ）

5点以内で要約：

```
【目的】このPRの目的
【主変更点】主要なコード・仕様変更
【影響範囲】フロントエンド/バックエンド/DB
【リスク】互換性・データ整合性・パフォーマンス
【テスト要点】動作確認の手順・重点的に確認すべき点
```

## アーキテクチャ原則

### バックエンド (Express + Supabase)

- **言語**: JavaScript (CommonJS) - `require()` を使用
- **フレームワーク**: Express.js
- **データベース**: Supabase (PostgreSQL) - `supabase-js` クライアントを使用
- **構成**:
  - 現在は `index.js` へのシングルファイル実装を基本とするが、機能肥大化に伴い適切にモジュール分割（`routes/` 等）を検討すること。
  - **Environment Variables**: `.env` ファイルで管理し、コード内にハードコードしないこと。

#### データベースアクセス
- `supabase.from('table').select()...` の形式でアクセス。
- **エラーハンドリング**: 必ず `try-catch` ブロックを使用し、API呼び出し元には適切なHTTPステータスコード（400系/500系）とエラーメッセージ（JSON）を返却すること。
- **バリデーション**: リクエストパラメータ（`req.query`, `req.body`）の検証を行うこと。

### フロントエンド (Next.js + Tailwind CSS)

- **言語**: TypeScript
- **フレームワーク**: Next.js (App Router)
- **スタイリング**: **Tailwind CSS v4** を使用。
  - `html`, `body`, コンポーネントのクラス指定にUtility Classを使用すること。
  - CSS Modulesや他のCSS-in-JSライブラリ（MUI, Emotion等）の導入は避けること。
- **コンポーネント設計**:
  - `src/components` またはルート直下の `components` ディレクトリに配置。
  - **Client Component**: 必要な場合のみ `"use client"` ディレクティブを使用すること。

#### 型安全性
- TypeScriptの厳密な型チェックを遵守すること。
- **`any` 型の使用は原則禁止**。必要な場合は型定義を作成すること（`types/index.ts` 等）。
- APIレスポンスの型定義を行い、フロントエンドで安全に扱えるようにすること。

## レビュー時の出力形式

コードレビューを実施する際は、以下の形式で出力してください（すべて日本語で記述）：

**重要**: すべてのレビューコメントには、必ず重要度を明示してください。【必須修正】【要改善】【任意】の3段階で表示すること。

```
## レビューサマリー
[PRの概要と主要な変更点を3-5行で簡潔に要約]

## 詳細レビュー

### 必須修正（マージ前に修正が必要）
- 【必須修正】[重大なバグ・セキュリティリスク・仕様不整合]
- 【必須修正】[具体的な問題点と修正方法]

### 推奨改善（できるだけ修正を推奨）
- 【要改善】[コード品質・可読性・パフォーマンスの改善点]
- 【要改善】[具体的な改善提案]

### 任意改善（将来的な改善提案）
- 【任意】[リファクタリング・スタイルの統一・コメントの改善]

## 良い点
- [実装の良い点や工夫されている点]
```

## コードレビュー時のチェックポイント

### 共通
1.  **日本語コメント**: コメントやコミットメッセージが日本語で記述されているか。
2.  **機密情報**: APIキーやDBパスワードがハードコードされていないか。

### バックエンド
1.  **エラーハンドリング**: `supabase` の呼び出しエラーや外部API（Open Food Facts等）のエラーが捕捉され、クラッシュせずに適切なレスポンスを返しているか。
2.  **入力チェック**: `req.body` や `req.query` の値が想定通りかチェックしているか。

### フロントエンド
1.  **型安全性**: `any` を使わず、適切なインターフェースや型エイリアスが定義されているか。
2.  **非同期処理**: `async/await` のエラーハンドリング（`try-catch`）が行われているか。ユーザーへのフィードバック（ローディング表示、エラー通知）があるか。
3.  **レスポンシブ**: Tailwind CSS のプレフィックス（`sm:`, `md:`, `lg:`）を用いてモバイル/デスクトップ両方に対応しているか。
4.  **React Hooks**: `useEffect`, `useMemo`, `useState` が適切に使用されているか（不要な再レンダリングや無限ループがないか）。
5.  **アクセシビリティ**: 適切なHTMLタグ（`button`, `input`等）が使われているか。画像の `alt` 属性があるか。

## 今後の開発フロー推奨

### バックエンド
- 機能が増えてきたら、`routes/` ディレクトリを作成し、エンドポイントごとにファイルを分割することを検討する。
- 共通の型定義（フロントエンドと共有できる型など）の整備。

### フロントエンド
- コンポーネントの再利用性を高め、必要に応じて共通コンポーネント化する。
- 複雑なロジックはカスタムフックへの切り出しを検討する。

## 参考
- [Next.js Documentation](https://nextjs.org/docs)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)
- [Supabase Documentation](https://supabase.com/docs)

